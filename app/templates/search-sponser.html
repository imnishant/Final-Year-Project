{% include "header.html" %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <script>
       if (window.web3) {
            metamaskWeb3 = new Web3(web3.currentProvider)

       }
       function sleep(milliseconds) {
  			const date = Date.now();
  			let currentDate = null;
  			do {
    			currentDate = Date.now();
  			} while (currentDate - date < milliseconds);
		}
        function sendETH(_from, _to, _value, _headline, _username)
        {
        	web3.eth.sendTransaction({
            	from: _from,
            	to: _to,
            	value: _value,
            	}, function(error, hash){
            	    console.log("Hash", hash);
            	    console.log("Error", error);
            	    var obj = document.getElementById("pay");
        			obj.remove();
        			document.getElementById('pay_message').innerHTML= "You Bought the Idea at Price:";
					var val = hash;
        			document.getElementById('hash_value').value = val;
					document.getElementById('cur_headline').value = _headline;
					document.getElementById('post_username').value = _username;
					document.getElementById('update_hash_form').submit();
        	});
        }


        function alert() {
			document.getElementById('alert').style.display = "none";
		}
    </script>

	<section style="margin-top:60px;">
		<div class="gap gray-bg">
			{% if msg %}
			<div class="container">
				<div class="row">
					<div class="col-md-2"></div>
					<div class="col-md-8">
					<div class="alert alert-warning alert-dismissible fade show" id="alert" role="alert">
						<h5>{{msg}}{{query}}</h5>
						<button type="button" class="close" onclick="alert()">
						<span aria-hidden="true">&times;</span>
					  	</button>
					</div>
					</div>
				</div>
			</div>
			{% endif %}
			<div class="container-fluid">
				<div class="row" id="page-contents">
					<div class="col-md-3">
						<aside class="sidebar static">
							<div class="widget">
								<h4 class="widget-title">Shortcuts</h4>
								<ul class="naves">
									<li>
										<i class="ti-clipboard"></i>
										<a href="/profile" title="">Profile</a>
									</li>
									<li>
										<i class="ti-power-off"></i>
										<a href="/logout" title="">Logout</a>
									</li>
								</ul>
							</div><!-- Shortcuts -->

						</aside>
					</div>
					<div class="col-md-6">
						<div class="central-meta">
							{% if found == "yes" %}
                                {% for user_details in result %}
                                    {% set username = user_details.email %}
                                    {% for post in user_details.posts %}
                                    <!-- add post new box -->
                                    <div class="loadMore">
                                    <div class="central-meta item" style="box-shadow:5px 5px 5px 5px grey;">
                                        <div class="user-post">
                                            <div class="friend-info">
                                                <figure>
                                                    <img src="static/BLOB/{{ username }}/images/{{user_details['profile']['display']}}" alt="">
                                                </figure>
                                                <div class="friend-name">
                                                    <ins><a href="time-line.html" title="">{{ user_details['profile']['fname'] + " " + user_details['profile']['lname'] }}</a></ins>
                                                    <span> Published on: {{ post['date_time_added'] }}</span>
                                                </div>
                                                <div class="post-meta">
                                                    <div class="description">

                                                        <p> {{ post.post_headline }} </p>

                                                    </div>
                                                    {% if post.post_type == 'image' %}
                                                        <img src="static/BLOB/{{ username }}/posts/{{post.post_type + 's'}}/{{post.post_name}}" align="middle">
                                                    {% endif %}
                                                    {% if post.post_type == 'video' %}
                                                        <video width="100%" height="auto" controls>
                                                            <source  src="static/BLOB/{{ username }}/posts/{{post.post_type + 's'}}/{{post.post_name}}" align="middle">
                                                        </video>
                                                    {% endif %}
                                                    {% if post.post_type == 'audio' %}
                                                        <center>
                                                        <audio controls>
                                                            <source src="static/BLOB/{{ username }}/posts/{{post.post_type + 's'}}/{{post.post_name}}">
                                                        </audio>
                                                        </center>
                                                    {% endif %}
                                                    {% if post.post_type == 'document' %}
                                                        <object data="static/BLOB/{{ username }}/posts/{{post.post_type + 's'}}/{{post.post_name}}" height="auto" width="100%"></object>
                                                    {% endif %}
                                                    <br>
                                                    <div class="row" style="padding:10px;">
                                                        <div class="col-md-6">Base Price: {{post.base_price}}</div>
                                                    {% if post.bid_price|length %}
                                                        <div class="col-md-6">Max. Bid Price: {{post.bid_price|last}} </div>
                                                    </div>
                                                        <table class="table table-striped">
                                                          <thead>
                                                            <tr>
                                                              <th scope="col">Bid Price</th>
                                                              <th scope="col">Bid Person</th>
                                                            </tr>
                                                          </thead>
                                                          <tbody>
                                                              {% for i in post.bid_price %}
                                                              {% set price = post.bid_price[loop.index-1] %}
                                                              {% set name = post.bidding_person[loop.index-1] %}
                                                                    <tr>
                                                                        <td>{{price}}</td>
                                                                        <td>{{name}}</td>
                                                                    </tr>
                                                              {% endfor %}
                                                          </tbody>
                                                    </table>
                                                    {% else %}
                                                                <div class="col-md-6">Max. Bid Price: --- </div>
                                                            </div>
                                                        <center class="alert alert-danger" role="alert">
                                                            <center>No Bids PLaced Yet!!</center>
                                                        </div>
                                                    {% endif %}
                                                    <br>
                                                </div>

                                                <center>
                                                    <form action="delete_post" method="POST">
                                                        <input type="text" name="filename" value="{{ post.post_name }}" hidden>
                                                        <input type="text" name="folder" value="{{ post.post_type }}" hidden>
                                                        <input type="text" name="date_time" value="{{ post.date_time_added }}" hidden>
                                                        <input type="text" name="headline" value="{{ post.post_headline }}" hidden>
                                                        <button type="submit">Delete</button>
                                                    </form>
                                                </center>
                                            </div>

                                        </div>
                                    </div>

                                    {% endfor %}
                                {% endfor %}
                        {% else %}
                            <div class="alert alert-danger" role="alert" style="width:100%;">
                                <center>{{ error_msg }} {{query}}</center>
                            </div>
                        {% endif %}
						</div>
					</div>
					<div class="col-md-3">
						<aside class="sidebar">
						<div class="widget">
							<h4 class="widget-title">
								Open Bids
							</h4>
							<ul class="naves">
								<li>
									{% if posts|length %}
									<table class="table table-striped">
									  <thead>
										<tr>
										  <th scope="col">Post By</th>
										  <th scope="col">Current Bid Price</th>
										</tr>
									  </thead>
									  <tbody>
										  {% for post in posts[::-1] %}
											{% if post.bidding_status == "open" %}
										  		{% set name = post.name %}
										  		{% if not post.bid_price %}
										  			{% set price = post.base_price %}
										  		{% else %}
										  			{% set price = post.bid_price[-1] %}
										  		{% endif %}
										  	<tr>
												<td>{{name}}</td>
												<td>{{price}}</td>
											</tr>
										  	{% endif %}
										  {% endfor %}
									  </tbody>
									</table>
									{% else %}
										<div class="alert alert-danger" role="alert" style="width:100%;">
											<center>No bids open!</center>
										</div>
									{% endif %}
								</li>
							</ul>
						</div>
						</aside>
					</div>
				</div>
			</div>
		</div>
	</section>

{% include "footer.html" %}
